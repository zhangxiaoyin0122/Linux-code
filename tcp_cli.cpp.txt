#include <stdlib.h>
#include "tcpsocket.hpp"


int main(int argc,char* argv[]){
    if(argc != 3){
        std::cout << "./tcp_cli 192.168.193.128 8000" << std::endl;
        return -1;
    }
    std::string ip = argv[1];
    uint16_t port = atoi(argv[2]);
    TcpSocket sock;
    //1.创建套接字
    CHECK_RET(sock.Socket());
    //2.绑定地址信息(客户端不需要主动绑定)
    
    //3.向服务端发起连接请求
    CHECK_RET(sock.Connect(ip,port));

    while(1){
        //4.发送数据
        std::string buf;
        std::cin >> buf;
        bool ret = sock.Send(buf);
        if(ret == false){
            sock.Close();
            return -1;
        }
        //5.接收收据
        buf.clear();
        ret = sock.Recv(buf);
        if(ret == false){
            sock.Close();
            return -1;
        }
        std::cout << "server say: " << buf << std::endl;
    }
    //6.关闭连接套接字
    sock.Close();
    return 0;
}
